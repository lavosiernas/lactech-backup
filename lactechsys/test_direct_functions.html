<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Direto das Funções - Funcionário</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase_config_fixed.js"></script>
    <script src="auth_fix.js"></script>
    <script src="funcionario_functions_fixed.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { margin: 5px; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>Teste Direto das Funções - Funcionário</h1>
    
    <!-- Elementos de teste -->
    <div id="testElements" style="display: none;">
        <div id="activityList">Lista de atividades aqui</div>
        <div id="productionChart">Gráfico aqui</div>
        <div id="todayVolume">Volume hoje</div>
        <div id="todayRecords">Registros hoje</div>
        <div id="weekAverage">Média semanal</div>
        <div id="bestDay">Melhor dia</div>
    </div>
    
    <div id="results"></div>
    
    <div style="margin-top: 20px;">
        <button class="btn-primary" onclick="testLoadDashboardIndicators()">Testar loadDashboardIndicators</button>
        <button class="btn-primary" onclick="testLoadRecentActivity()">Testar loadRecentActivity</button>
        <button class="btn-primary" onclick="testLoadProductionChart()">Testar loadProductionChart</button>
        <button class="btn-success" onclick="testAllFunctions()">Testar Todas as Funções</button>
        <button class="btn-danger" onclick="clearResults()">Limpar Resultados</button>
    </div>

    <script>
        const results = document.getElementById('results');
        
        function addResult(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <div>${content}</div>
            `;
            results.appendChild(div);
        }

        function clearResults() {
            results.innerHTML = '';
        }

        async function testLoadDashboardIndicators() {
            addResult('Testando loadDashboardIndicators', 'Executando...', 'info');
            
            try {
                if (typeof window.funcionarioAPI?.loadDashboardIndicators === 'function') {
                    await window.funcionarioAPI.loadDashboardIndicators();
                    addResult('loadDashboardIndicators', '✅ EXECUTADA COM SUCESSO', 'success');
                } else {
                    addResult('loadDashboardIndicators', '❌ FUNÇÃO NÃO ENCONTRADA', 'error');
                }
            } catch (error) {
                addResult('loadDashboardIndicators', `❌ ERRO: ${error.message}`, 'error');
            }
        }

        async function testLoadRecentActivity() {
            addResult('Testando loadRecentActivity', 'Executando...', 'info');
            
            try {
                if (typeof window.funcionarioAPI?.loadRecentActivity === 'function') {
                    await window.funcionarioAPI.loadRecentActivity();
                    addResult('loadRecentActivity', '✅ EXECUTADA COM SUCESSO', 'success');
                } else {
                    addResult('loadRecentActivity', '❌ FUNÇÃO NÃO ENCONTRADA', 'error');
                }
            } catch (error) {
                addResult('loadRecentActivity', `❌ ERRO: ${error.message}`, 'error');
            }
        }

        async function testLoadProductionChart() {
            addResult('Testando loadProductionChart', 'Executando...', 'info');
            
            try {
                if (typeof window.funcionarioAPI?.loadProductionChart === 'function') {
                    await window.funcionarioAPI.loadProductionChart();
                    addResult('loadProductionChart', '✅ EXECUTADA COM SUCESSO', 'success');
                } else {
                    addResult('loadProductionChart', '❌ FUNÇÃO NÃO ENCONTRADA', 'error');
                }
            } catch (error) {
                addResult('loadProductionChart', `❌ ERRO: ${error.message}`, 'error');
            }
        }

        async function testAllFunctions() {
            addResult('Iniciando Teste Completo', 'Testando todas as funções...', 'info');
            
            // Verificar autenticação primeiro
            try {
                const authResult = await window.authFix.checkAuthenticationFixed();
                addResult('Autenticação', `Status: ${authResult ? '✅ AUTENTICADO' : '❌ NÃO AUTENTICADO'}`, authResult ? 'success' : 'error');
                
                if (!authResult) {
                    addResult('Aviso', 'Usuário não autenticado. Alguns testes podem falhar.', 'error');
                }
            } catch (error) {
                addResult('Autenticação', `❌ ERRO: ${error.message}`, 'error');
            }

            // Testar cada função
            await testLoadDashboardIndicators();
            await testLoadRecentActivity();
            await testLoadProductionChart();

            addResult('Teste Completo Concluído', 'Todos os testes foram executados. Verifique os resultados acima.', 'info');
        }

        // Verificar disponibilidade das funções quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            addResult('Verificação Inicial', 'Verificando disponibilidade das funções...', 'info');
            
            const functions = [
                'loadManagerReportSettings',
                'loadRecentActivity',
                'loadProductionChart',
                'loadDashboardIndicators'
            ];
            
            functions.forEach(funcName => {
                const isAvailable = typeof window.funcionarioAPI?.[funcName] === 'function';
                addResult(`Função ${funcName}`, 
                    isAvailable ? '✅ DISPONÍVEL' : '❌ NÃO DISPONÍVEL', 
                    isAvailable ? 'success' : 'error');
            });

            // Verificar elementos HTML
            const elements = [
                'activityList',
                'productionChart',
                'todayVolume',
                'todayRecords',
                'weekAverage',
                'bestDay'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                const exists = element !== null;
                addResult(`Elemento ${elementId}`, 
                    exists ? '✅ ENCONTRADO' : '❌ NÃO ENCONTRADO', 
                    exists ? 'success' : 'error');
            });
        });
    </script>
</body>
</html> 